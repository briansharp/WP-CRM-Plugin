function crm_createCustomer(){
	var action = "crm_spi_addCustomer";
	postdata("action=" + action + "&" + jQuery(this).serialize());
	return false;
};

function crm_delCustomer(){
	var action = "crm_spi_delCustomer";
	postdata("action=" + action + "&" + jQuery(this).serialize());
	return false;
};

function crm_rnmCustomer(){
	var action = "crm_spi_rnmCustomer";
	postdata("action=" + action + "&" + jQuery(this).serialize());
	return false;
};

function crm_createLocation(){	
	var action = "crm_spi_addLocation";
	postdata("action=" + action + "&" + jQuery(this).serialize());
	return false;
};

function crm_delLocation(){	
	var action = "crm_spi_deleteLocation";
	postdata("action=" + action + "&" + jQuery(this).serialize());
	return false;
};

function crm_rnmLocation(){
	var action = "crm_spi_renameLocation";
	postdata("action=" + action + "&" + jQuery(this).serialize());
	return false;	
};

function crm_addSupport(){	
	var action = "crm_spi_addSupport";
	postdata("action=" + action + "&" + jQuery(this).serialize());
	return false;
};

function crm_delSupport(){	
	var action = "crm_spi_delSupport";
	postdata("action=" + action + "&" + jQuery(this).serialize());
	return false;
};

function crm_rnmSupport(){
	var action = "crm_spi_renameSupport";
	postdata("action=" + action + "&" + jQuery(this).serialize());
	return false;	
};

function crm_rnmUser(){
	var action = "crm_spi_updateUser";
	postdata("action=" + action + "&" + jQuery(this).serialize());
	return false;	
};

function crm_initTicket(){
	var action = "crm_spi_initTicket";
	post("view=dashboard&ticketcreated=" + Date() + "&action=" + action + "&" + jQuery(this).serialize(), true);
	return false;	
};

function crm_addTicket(wrap_view = false){
	var action = "crm_spi_addTicket";
	post(wrap_view, "action=" + action + "&" + jQuery(this).serialize());
	return false;	
};

function crm_delTicket(id, currentPage=1, filters=""){
	var action = "crm_spi_delTicket";
	post("action=" + action + "&view=default&ticketid=" + id + "&page=" + currentPage + "&filters=" + filters);
	return false;	
};

function crm_updTicket(wrap_view = false){
	var action = "crm_spi_updTicket";
	post("action=" + action + "&view=dashboard&" + jQuery(this).serialize(),wrap_view);
	return false;	
};

function crm_openEditTicket(wrap_view, ticketid){
	var action = "crm_spi_getView";
	post("action=" + action + "&view=updateentry&ticketid=" + ticketid, wrap_view, true  );
	return false;
};

function crm_viewTickets(wrap_view, filters, page=1){
	var action = "crm_spi_getView";
	post("action=" + action + "&view=default&filters="+ filters + "&page=" + page, wrap_view, true );
	return false;
};

function crm_reports(view, wrap_view=false, page=1){
	var action = "crm_spi_getReport";
	post("action=" + action + "&view=results&page=" + page, wrap_view );
	return false;
};

function crm_view(view, wrap_view=false, page=1){
	var action = "crm_spi_getView";
	post("action=" + action + "&view=" + view + "&page=" + page, wrap_view, true );
	return false;
};

//called mostly by ajax form submit events
function post(data = "", wrap_view = false, page_top = false){    
	jQuery(".entry-content").css({'cursor' : 'wait'});
    var request = jQuery.ajax({
        type:		'POST',
        url: 		ajax_postHandler.ajaxurl,
		data: 		data + "&wrap_view=" + wrap_view,
        cache: 		false,
        success:	function(result){
							try { // Try parse json error result; catch, new view was successfully returned
								var json = jQuery.parseJSON(result);
								jQuery( json.element ).html( json.error );
							} catch (e) { //or update view on success
								wrap_view ? jQuery( ".entry-content" ).html(result) : jQuery( ".crm-inner-content" ).html(result);
								if (page_top){
									document.getElementById('crm_top').parentNode.scrollIntoView();
							}};
							jQuery(".entry-content").css({'cursor' : 'default'});
							window.scrollBy(0, -10);
					}
	});
	request.fail(function( jqXHR, textStatus ) {alert( "Request failed: textStatus " + textStatus );});
};	


//called mostly by ajax form submit events
function postdata(data, wrap_view = false){    
	jQuery(".entry-content").css({'cursor' : 'wait'});
    var request = jQuery.ajax({
        type:		'POST',
        url: 		ajax_postHandler.ajaxurl,
		data: 		data,
        cache: 		false,
        success:	function(result){
							try { // Try parse json error result; catch, new view was successfully returned
								var json = jQuery.parseJSON(result);
								jQuery( json.element ).html( json.error );
							} catch (e) { //or update view on success
								if (wrap_view == true){
									jQuery( ".entry-content" ).html(result);
								} else {jQuery( ".crm-inner-content" ).html(result);}
							};
							jQuery(".entry-content").css({'cursor' : 'default'});		
					}
    });	
	request.fail(function( jqXHR, textStatus ) {alert( "Request failed: textStatus " + textStatus );});
	return false;	
};


//called mostly by ajax click events instead of anchor href
function crm_getView(view, wrap_view = false, page = 1, crm_uid = -1){
	
	jQuery(".entry-content").css({'cursor' : 'wait'});
    var request = jQuery.ajax({
        type:		'POST',
        url: 		ajax_postHandler.ajaxurl,
		data: 		{'action':'crm_spi_getView','view': view,'wrap_view':wrap_view,'page': page,'uid':crm_uid},
        cache: 		false,
        success:	function(result){
							try { // Try parse json error result; catch, new view was successfully returned
								var json = jQuery.parseJSON(result);
								jQuery( json.element ).html( json.error );
							} catch (e) { //or update view on success
								if (view == "dashboard" || wrap_view){
									jQuery( ".entry-content" ).html(result);
								} else {jQuery( ".crm-inner-content" ).html(result);}
							};
							jQuery(".entry-content").css({'cursor' : 'default'});
					}
    });
	request.fail(function( jqXHR, textStatus ) {alert( "Request failed: textStatus " + textStatus );});
	return false;	
};
